
<p align="center">
  <img src="https://digitalbusiness.kz/wp-content/uploads/2022/11/indrive-logo_ok-01.png" alt="Car Example" width="400"/>
  
</p>


# Определение состояния автомобиля по фото

## Общие сведения

Определение состояния автомобиля по фото.

## Подробное описание задачи

Модель по фото определяет: грязный / чистый, битый / целый. Помогает повысить безопасность, доверие пассажиров и качество сервиса inDrive.

## Проблема

- Нет автоматического, масштабируемого способа оценивать внешний вид и повреждения автомобилей.

- Пассажиры получают непредсказуемый опыт (грязная или повреждённая машина → недовольство, жалобы).

- Оперативный контроль качества у сервиса фрагментирован и часто ручной.

- Водители редко получают напоминания о поддержании машины в хорошем состоянии.

## Ценность (зачем это нужно inDrive)

- Доверие пассажиров — визуальные метки/индикации повышают уверенность при выборе поездки.

- Качество сервиса — автоматическая проверка позволяет поддерживать стандарты и быстрее устранять несоответствия.

- Safety-сигналы в UI — предупреждения о серьёзных повреждениях или опасных ситуациях (сломанные фары, разбитое стекло).

# Новая операционная ценность:

- Напоминание водителю: push/внутреннее уведомление — помыть авто, устранить мелкие повреждения.

- Предупреждение пассажиру: показ в приложении (например «машина имеет следы повреждений/грязи»).

- Сигнал в систему качества: агрегированные отчёты для аналитики, KPI и компенсаций.

- Экономическая польза — снижение числа жалоб и возвратов, улучшение удержания клиентов и рейтингов.

- Маркетинговая польза — возможность позиционировать сервис как более надёжный и заботящийся о комфорте.

## Данные & разметка  

- **Чистый / грязный автомобиль**:  
  - Датасет собирался самостоятельно.  
  - Источники изображений: OLX, Baidu, Avito (поиск по объявлениям).  
  - Изображения скачивались по URL и вручную сортировались по категориям.  
  - Разметка выполнялась вручную: каждое фото классифицировалось как "чистый" или "грязный".
  - Данные разделены в пропорции **80% / 10% / 10%** (train / val / test).  

| Class | Train | Validation | Test |
|-------|-------|------------|------|
| Clean | 580   | 75         | 75   |
| Dirty | 580   | 75         | 75   |

- **Битый / целый автомобиль**:  
  - Для класса **"битый"** использовался открытый датасет **CarDD**.  
  - Для класса **"целый"** использовались изображения из самостоятельно собранного датасета (OLX, Baidu, Avito).
  - Данные разделены в пропорции **80% / 10% / 10%** (train / val / test).  

| Class       | Train | Validation | Test |
|-------------|-------|------------|------|
| Damaged     | 2226  | 278        | 278  |
| Not Damaged | 2230  | 279        | 279  |
  - Источник CarDD:  
    ```bibtex
    @article{CarDD,
        author={Wang, Xinkuang and Li, Wenjing and Wu, Zhongcheng},
        journal={IEEE Transactions on Intelligent Transportation Systems}, 
        title={CarDD: A New Dataset for Vision-Based Car Damage Detection}, 
        year={2023},
        volume={24},
        number={7},
        pages={7202-7214},
        doi={10.1109/TITS.2023.3258480}
    }
    ```

    
## Модель & подход  

- Используется **двухэтапный пайплайн**:  
  1. **Детекция автомобиля**:  
     - На вход подаётся фото.  
     - Сначала применяется **YOLO11-M** для поиска автомобиля.  
     - Если объект "автомобиль" не найден → возвращается результат "нет машины".  
     - Если найден → изображение кропается по детекции.  

  2. **Классификация состояния**:  
     - Для **чистый / грязный**: используется **EfficientNet-B1**.  
     - Для **битый / целый**: используется **EfficientNet-B2**.  

- Дополнительный шаг для задачи "битый / целый":  
  - Так как в датасете CarDD изображения часто приближены к зонам повреждений, а входная фотография может содержать машину целиком, вводится приём разбиения изображения.  
  - После кропа с YOLO изображение делится на **4 сегмента**.  
  - Каждый сегмент подаётся в EfficientNet-B2.  
  - Если хотя бы **один сегмент классифицируется как "битый"**, вся машина считается "битой".  

- **Обоснование подхода**:  
  - YOLO11-M гарантирует, что классификаторы работают только по объекту "автомобиль", а не по фону.  
  - Разделение на сегменты позволяет находить локальные повреждения, которые могли бы быть потеряны на полном изображении.  
  - Использование разных моделей (B1 и B2) оптимизирует работу под разные подзадачи.  

## Метрики & валидация  

- **Основная метрика**: Accuracy (точность классификации).  
  - Выбрана, так как классы в собранных датасетах сбалансированы.  

- **Валидация**:  
  - Отдельные тестовые выборки для задач "чистый/грязный" и "битый/целый".  
  - Проверка работы модели на edge-case сценариях:  
    - Ночное освещение.  
    - Дождь, снег, туман.  
    - Блики и отражения.  
    - Разные ракурсы автомобиля.  

- **Анализ ошибок**:  
  - Ошибки фиксируются и анализируются для последующего улучшения модели.  
  - Особое внимание на случаи, когда:  
    - Разводы/ржавчина → модель классифицирует как грязь.  
    - Небольшие повреждения не видны при делении изображения на сегменты.  

## Демо & UX

<img width="3432" height="2146" alt="image" src="https://github.com/user-attachments/assets/60f4b50f-87ed-460f-96ed-400ca641de97" />

<img width="3368" height="1902" alt="image" src="https://github.com/user-attachments/assets/13f397d1-84a5-48a3-b38d-4594fdba4e8e" />


## Локальный запуск

### 1. Клонировать репозиторий
~~~bash
git clone https://github.com/yerzhantemirali/Bubu-men-Dudu.git
cd your-repo-name
~~~

### 2. Создать и активировать виртуальное окружение (Python)
~~~bash
python3 -m venv venv
source venv/bin/activate   # Mac/Linux
venv\Scripts\activate      # Windows
~~~

### 3. Установить зависимости
~~~bash
pip install --upgrade pip
pip install -r requirements.txt
~~~

### 4. Запустить бэкенд (FastAPI)
~~~bash
cd backend
uvicorn main:app --reload
~~~
- Бэкенд будет доступен по адресу: `http://127.0.0.1:8000`.

### 5. Запустить фронтенд (React) в новом терминале
~~~bash
cd frontend
npm install   # только при первом запуске
npm run dev
~~~
- Фронтенд будет доступен по адресу: `http://localhost:3000`.

### 6. Открыть в браузере
Перейти `http://localhost:3000`

 
## Надежность & этика  

- **Приватность**:  
  - Фото могут содержать номера машин, лица людей или объекты окружения.  
  - Необходимо размывать такие элементы перед обучением/инференсом.  

- **Bias (смещения)**:  
  - Разное качество камер (смартфон / видеорегистратор / проф. камера).  
  - Мало изображений ночью, при снеге, дожде, тумане.  
  - Возможна путаница: разводы после химчистки или ржавчина → классифицируются как грязь.  

- **Ограничения**:  
  - Малый и несбалансированный датасет.  
  - Ошибки в условиях сильных бликов, плохой погоды.  
  - Нет промежуточных классов (например, "слегка грязный").  

